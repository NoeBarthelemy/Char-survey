---
title: "Char_survey_analysis"
author: 'No√© Barthelemy'
date: "28/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Library
```{r}
library(tidyverse)
library(readxl)
library(esquisse)
```

This is empty but I needed a script to try the sharing process with Rowan.

```{r}
Survey_Dummy_Variables_Rowan_V1_NB_edits <- read_excel("~/Bureau/PHD/Ongoing_Projects/Economics/DATA_SURVEY/Survey Dummy Variables_Rowan_V1_SEP2021.xlsx")

# Keep that one stored as backup object 
# Original_from_Rowan_BACKUP <- Survey_Dummy_Variables_Rowan_V1_NB_edits
```
Create some dummy variables to re-create what Rowan did originally by hand on excel: 
--> The current position is sorted.

```{r}
Survey_Dummy_Variables_Rowan_V1_September2021 <- Survey_Dummy_Variables_Rowan_V1_NB_edits %>% 
  mutate(., Male = ifelse(Gender == "Male", 1, 0)) %>%
  mutate(., Female = ifelse(Gender == "Female", 1, 0)) %>% 
  mutate(., Employed_Dummy = ifelse(Employment_status == "Employed", 1, 0)) %>% 
  mutate(., Retired_Dummy = ifelse(Employment_status == "Retired", 1, 0)) %>% 
  mutate(., Student_Dummy = ifelse(Employment_status == "Full time student / apprenticeship", 1, 0)) %>% 
  mutate(., Undergrad_Dummy = ifelse(Highest_education_level == "University - undergraduate degree", 1, 0)) %>% 
  mutate(., Postgrad_Dummy = ifelse(Highest_education_level == "University - postgraduate degree", 1, 0)) %>% 
  mutate(., No_Papers_Dummy = ifelse(Publications_read == "0", 1, 0)) %>% 
  mutate(., Some_Papers_Dummy = ifelse(Publications_read %in% c("1-5", "6-10", "11-20"), 1, 0)) %>% 
  mutate(., Many_Papers_Dummy = ifelse(Publications_read == "21+", 1, 0)) %>% 
  # Now sort the lottery thing: 
  mutate(., Q1_Risk_Rating = ifelse(Risk_lottery_money_99 == "Option A", 0, 1)) %>% 
  mutate(., Q2_Risk_Rating = ifelse(Risk_lottery_money_90 == "Option A", 0, 2)) %>% 
  mutate(., Q3_Risk_Rating = ifelse(Risk_lottery_money_80 == "Option A", 0, 3)) %>% 
  mutate(., Q4_Risk_Rating = ifelse(Risk_lottery_money_70 == "Option A", 0, 4)) %>% 
  mutate(., Q5_Risk_Rating = ifelse(Risk_lottery_money_60 == "Option A", 0, 5)) %>% 
  mutate(., Q6_Risk_Rating = ifelse(Risk_lottery_money_50 == "Option A", 0, 6)) %>% 
  mutate(., Q7_Risk_Rating = ifelse(Risk_lottery_money_40 == "Option A", 0, 7)) %>% 
  mutate(., Q8_Risk_Rating = ifelse(Risk_lottery_money_30 == "Option A", 0, 8)) %>% 
  mutate(., Q9_Risk_Rating = ifelse(Risk_lottery_money_20 == "Option A", 0, 9)) %>% 
  mutate(., Q10_Risk_Rating = ifelse(Risk_lottery_money_10 == "Option A", 0, 10)) %>% 
  rowwise(.) %>% 
  mutate(., Average_Lotto_Risk_Rating = mean(c(Q1_Risk_Rating, Q2_Risk_Rating, Q3_Risk_Rating, Q4_Risk_Rating, Q5_Risk_Rating, Q6_Risk_Rating, Q7_Risk_Rating, Q8_Risk_Rating, Q9_Risk_Rating, Q10_Risk_Rating))) %>% 
  # Now sort the population lottery thing: 
  mutate(., Q1_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_99 == "Option A", 0, 1)) %>% 
  mutate(., Q2_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_90 == "Option A", 0, 2)) %>% 
  mutate(., Q3_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_80 == "Option A", 0, 3)) %>% 
  mutate(., Q4_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_70 == "Option A", 0, 4)) %>% 
  mutate(., Q5_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_60 == "Option A", 0, 5)) %>% 
  mutate(., Q6_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_50 == "Option A", 0, 6)) %>% 
  mutate(., Q7_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_40 == "Option A", 0, 7)) %>% 
  mutate(., Q8_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_30 == "Option A", 0, 8)) %>% 
  mutate(., Q9_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_20 == "Option A", 0, 9)) %>% 
  mutate(., Q10_Conservation_Risk_Rating_ = ifelse(Risk_lottery_populations_10 == "Option A", 0, 10)) %>% 
  rowwise(.) %>% 
  mutate(., Average_Cons_Risk_Rating_ = mean(c(Q1_Conservation_Risk_Rating_, Q2_Conservation_Risk_Rating_, Q3_Conservation_Risk_Rating_, Q4_Conservation_Risk_Rating_, Q5_Conservation_Risk_Rating_, Q6_Conservation_Risk_Rating_, Q7_Conservation_Risk_Rating_, Q8_Conservation_Risk_Rating_, Q9_Conservation_Risk_Rating_, Q10_Conservation_Risk_Rating_)))

```



Threshold 10% of dataset to make a variable significant in the regression. 

List of things to do : 
7) Manually (or with code) tidy the "Highest education level" variable. The "College" should be put as "Undergraduate", to reflect the higher education level that it is.

8) Discuss with George about the missing values and how to deal with them: Remove them, impute the mean observation, impute with a predictive model or create dummy variables to bypass the whole thing?  (Same thing for "Char conservation interest" and "Sufficiently protected")

For the true or false: ALSO, report in the text of the paper which answers were really common and interesting (eg. if people think that char are endangered).

9) For "Arctic char qualities", record the common answers and report it in the paper and discuss. 

11) Publications read: Keep the three dummies. Check correlation between that and the True or False score. 

Next meeting: 10/09/2021 

12) Get the CRRA into a code.

More info about the CRRA : http://library.lshtm.ac.uk/MSc_PHDC/2014-2015/108643.pdf 
*** 
What we did is replaced the "inf" value of CRRA by -2 for VERY risk lobing people
AND by -2.5 for the people who never switched ! 
***

After meeting : 

13) Check if the respondents who allocated more to HR in round 1 than in Round 2 (weird!) actually anticipated more than others that the LR pops could be unique too !












ABOUT NA'S in regression models: 
https://bookdown.org/egarpor/PM-UC3M/app-nas.html 




# 1) Dataset filtering and formatting. 

## A) Filter completion level and data missingness

For now we filter anything below 50 percent. 
```{r}
# At this point I'm also going to add random names to the answers using the babynames dataset
# Add a unique ID to each answer
 
library(babynames)
data(babynames)

Baby_names_only <- babynames %>% select(., name) %>% unique()

# Commented line below so that the names don't change once sampled! 
# Baby_names_sample <- sample_n(Baby_names_only, nrow(Survey_Dummy_Variables_Rowan_V1_September2021)) 
Survey_Dummy_Variables_Rowan_V1_September2021 <- cbind(Baby_names_sample, Survey_Dummy_Variables_Rowan_V1_September2021)

Survey_Dummy_Variables_Rowan_V2 <- Survey_Dummy_Variables_Rowan_V1_September2021 %>% 
  filter(., Progress >= 70) %>% 
  # Create a variable that summarises missing data.
  mutate(MissingData = rowSums(is.na(.))) %>% 
  filter(., MissingData <= 20) %>% 
  select(., MissingData, everything()) 
```
apply(mtcars, MARGIN = 1, function(x) sum(is.na(x)))

## B) Sort the "Country" variable.

First we clean it. 
```{r}
Survey_Dummy_Variables_Rowan_V3 <- Survey_Dummy_Variables_Rowan_V2 %>% 
  ## We need one row per special case.
  mutate(., Country = if_else(condition = Country == "uk", true = "UK", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "GB", true = "UK", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "United Kingdom", true = "UK", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "ireland", true = "Ireland", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "Ireland.", true = "Ireland", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "canada", true = "Canada", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "germany", true = "Germany", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "N.Ireland", true = "Northern_Ireland", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "Nlreland", true = "Northern_Ireland", false = Country)) %>% 
  mutate(., Country = if_else(condition = Country == "Northern Ireland", true = "Northern_Ireland", false = Country)) %>% 
  ## Special_case : No country entered. 
  mutate(., Country = if_else(condition = is.na(Country), true = "Unknown", false = Country)) %>% 
  select(., Country, everything())
```

Then we add variables that are going to summarise them in upper groups. 
```{r}
Survey_Dummy_Variables_Rowan_V4 <- Survey_Dummy_Variables_Rowan_V3 %>% 
  mutate(., Geographic_group = if_else(condition = Country %in% c("UK", "Ireland", "Northern_Ireland", "England", "Scotland", "Wales"), true = "North_Atlantic_Isles", false = if_else(condition = Country %in% c("Germany", "France", "Italy", "Norway", "Czech Republic", "Netherlands", "Sweden", "Denmark", "Finland", "Switzerland"), true = "Other_Europe", false = if_else(condition = Country %in% c("Canada", "USA"), true = "North_America", false = "WhereIsThat?" )))) %>% 
  select(., Country,Geographic_group, everything())
```

## C) Sort the "Year of Birth" variable.

```{r}
Survey_Dummy_Variables_Rowan_V5 <- Survey_Dummy_Variables_Rowan_V4 %>% 
  # Create the age variable
  mutate(., Age = 2021 - as.numeric(Year_of_birth)) %>% 
  # Group by class of age ! 
  mutate(., Age_grouped = if_else(Age <= 30, "EarlyAge", if_else(Age >= 31 & Age <= 60, "MediumAge", if_else(Age >= 61, "OldAge", "Problem!!")))) %>% 
  select(., Year_of_birth, Age,Age_grouped,  everything()) 
```

## D) Sort the "Current position" dummies.

```{r}
Survey_Dummy_Variables_Rowan_V6 <- Survey_Dummy_Variables_Rowan_V5 %>% 
  separate(., Current_position, into = c("Position1", "Position2", "Position3"), sep = ",") %>% 
  mutate(., University_Research_Dummy = if_else(condition = Position1 == "University (public) research" | Position2 == "University (public) research" | Position3 == "University (public) research", true = 1, false = 0, missing = 0)) %>%  
  mutate(., Environmental_Protection_Agency_Dummy = if_else(condition = Position1 == "Environmental protection agency" | Position2 == "Environmental protection agency" | Position3 == "Environmental protection agency", true = 1, false = 0, missing = 0)) %>%  
  mutate(., Wildlife_Conservation_Dummy = if_else(condition = Position1 == "Wildlife conservation agency" | Position2 == "Wildlife conservation agency" | Position3 == "Wildlife conservation agency", true = 1, false = 0, missing = 0)) %>% 
  # It did the job, let's filter out those useless columns: 
  select(., -c("Position1", "Position2","Position3"))
  
```

## E) Sort the conservation experience variable

  Change the conservation experience variable, put them all in dummy variables. 
  Use gsub to remov the "Yes,".
  
```{r}
Survey_Dummy_Variables_Rowan_V7 <- Survey_Dummy_Variables_Rowan_V6 %>% 
  mutate(., Volunteering_Exp_Dummy = ifelse(grepl(pattern = "volunteering", x = Conservation_experience) == T, yes = "1",  no =  "0")) %>% 
  mutate(., Work_Exp_Dummy = ifelse(grepl(pattern = "work", x = Conservation_experience) == T, yes = "1",  no =  "0")) %>% 
  mutate(., Study_Exp_Dummy = ifelse(grepl(pattern = "studies", x = Conservation_experience) == T, yes = "1",  no =  "0")) 
```


## F) Sort the "I don't know"'s.

Missing values and how to deal with them: Remove them, impute the mean observation, impute with a predictive model or create dummy variables to bypass the whole thing?  (Same thing for "Char conservation interest" and "Sufficiently protected")

Let's inspect how much missing data we have in the first place !
```{r}
Survey_Dummy_Variables_Rowan_V7 %>% 
  count(., Confidence_in_survey == "I don't know")
```
```{r}
Survey_Dummy_Variables_Rowan_V7 %>% 
  count(., Char_conservation_interest == "I don't know")
```
```{r}
Survey_Dummy_Variables_Rowan_V7 %>% 
  count(., Scale_Sufficently_Protected_First == "I don't know")
```
So quite low numbers after all. Let's turn them into the mean observation! 

Calculate the mean of observations:
```{r}
Mean_Confidence_in_survey = mean(as.numeric(Survey_Dummy_Variables_Rowan_V7$Confidence_in_survey), na.rm = T)
Mean_Char_conservation_interest = mean(as.numeric(Survey_Dummy_Variables_Rowan_V7$Char_conservation_interest), na.rm = T)
Mean_Scale_Sufficently_Protected_First = mean(as.numeric(Survey_Dummy_Variables_Rowan_V7$Scale_Sufficently_Protected_First), na.rm = T)
Mean_Scale_Sufficently_Protected_Second = mean(as.numeric(Survey_Dummy_Variables_Rowan_V7$Scale_Sufficently_Protected_Second), na.rm = T)

Mean_Confidence_in_survey
Mean_Char_conservation_interest
Mean_Scale_Sufficently_Protected_First
```
Change the "I don't know" for the mean values
```{r}
Survey_Dummy_Variables_Rowan_V8 <- Survey_Dummy_Variables_Rowan_V7 %>% 
  mutate(., Confidence_in_survey = ifelse(Confidence_in_survey == "I don't know", yes = Mean_Confidence_in_survey, no = Confidence_in_survey)) %>% 
  mutate(., Char_conservation_interest = ifelse(Char_conservation_interest == "I don't know", yes = Mean_Char_conservation_interest, no = Char_conservation_interest)) %>% 
  mutate(., Scale_Sufficently_Protected_First = ifelse(Scale_Sufficently_Protected_First == "I don't know", yes = Mean_Scale_Sufficently_Protected_First, no = Scale_Sufficently_Protected_First)) %>% 
  mutate(., Scale_Sufficently_Protected_Second = ifelse(Scale_Sufficently_Protected_Second == "I don't know", yes = Mean_Scale_Sufficently_Protected_Second, no = Scale_Sufficently_Protected_Second))
  
```

## G) Sort the "True or False"

For the "True or false" : Use regex to create a dummy variable for each answer, then compute a score: +1 point for each true answer, -1 for each negative. ALSO, report in the text of the paper which answers were really common and interesting (eg. if people think that char are endangered).

It is relatively easy but takes a few lines of code:
We'll create score variables for each value found, and then sum up this into a global score variable.
Then we remove the score variables and keep only the global score.
```{r}
# We need a function to operate the sum at the end
p_sum <- function(...) {
  rowSums(pick(...))
}


Survey_Dummy_Variables_Rowan_V9 <- Survey_Dummy_Variables_Rowan_V8 %>% 
  # The true ones first: 
  mutate(., TrueFalse_DV_3 = ifelse(grepl(pattern = "oldest", x = True_false_question) == T, yes = 1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_5 = ifelse(grepl(pattern = "phenotypic", x = True_false_question) == T, yes = 1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_6 = ifelse(grepl(pattern = "different", x = True_false_question) == T, yes = 1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_7 = ifelse(grepl(pattern = "extinct", x = True_false_question) == T, yes = 1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_9 = ifelse(grepl(pattern = "sensitive", x = True_false_question) == T, yes = 1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_12= ifelse(grepl(pattern = "colorful", x = True_false_question) == T, yes = 1,  no =  "0")) %>% 
  # Now the false one, minus one point: 
  mutate(., TrueFalse_DV_1 = ifelse(grepl(pattern = "farming", x = True_false_question) == T, yes = -1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_2 = ifelse(grepl(pattern = "IUCN", x = True_false_question) == T, yes = -1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_4 = ifelse(grepl(pattern = "Brown", x = True_false_question) == T, yes = -1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_8 = ifelse(grepl(pattern = "declined", x = True_false_question) == T, yes = -1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_10= ifelse(grepl(pattern = "Climate", x = True_false_question) == T, yes = -1,  no =  "0")) %>% 
  mutate(., TrueFalse_DV_11= ifelse(grepl(pattern = "Anadromous", x = True_false_question) == T, yes = -1,  no =  "0")) %>% 
  # Make a score.
  mutate(., TrueFalseScore = as.numeric(TrueFalse_DV_1)+ as.numeric(TrueFalse_DV_2)+ as.numeric(TrueFalse_DV_3)+ as.numeric(TrueFalse_DV_4)+ as.numeric(TrueFalse_DV_5)+ as.numeric(TrueFalse_DV_6)+ as.numeric(TrueFalse_DV_7)+ as.numeric(TrueFalse_DV_8)+ as.numeric(TrueFalse_DV_9) +as.numeric(TrueFalse_DV_10)+ as.numeric(TrueFalse_DV_11) + as.numeric(TrueFalse_DV_12)) %>% 
  # Remove the crap.
  select(., -c(TrueFalse_DV_1, TrueFalse_DV_2, TrueFalse_DV_3, TrueFalse_DV_4, TrueFalse_DV_5, TrueFalse_DV_6, TrueFalse_DV_7,TrueFalse_DV_8,TrueFalse_DV_9,TrueFalse_DV_10,TrueFalse_DV_11,TrueFalse_DV_12))
```
## H) Calculate the "Lottery switch" and "CRRA" values

Basically, when are they switching from B to A ?

	CRRA
1	0.98
2	0.84
3	0.67
4	0.48
5	0.26
6	0
7	-0.33
8	-0.74
9	-1.33
10	inf  

Less than 0 is risk loving 	
0 is risk neutral 	
More than 0 is risk averse	

### I) For the money lottery
```{r}
Survey_Dummy_Variables_Rowan_V10 <- Survey_Dummy_Variables_Rowan_V9 %>% 
  mutate(., Money_Switch = ifelse(Risk_lottery_money_99 == "Option A", "99", ifelse(Risk_lottery_money_90 == "Option A", "90", ifelse(Risk_lottery_money_80 == "Option A", "80",ifelse(Risk_lottery_money_70 == "Option A", "70", ifelse(Risk_lottery_money_60 == "Option A", "60", ifelse(Risk_lottery_money_50 == "Option A", "50", ifelse(Risk_lottery_money_40 == "Option A", "40", ifelse(Risk_lottery_money_30 == "Option A", "30", ifelse(Risk_lottery_money_30 == "Option A", "30", ifelse(Risk_lottery_money_20 == "Option A", "20", ifelse(Risk_lottery_money_10 == "Option A", "10", "0"))) )))) ) )) )) %>% 
  
  # Get the CRRA into the code 
  mutate(., Money_CRRA = ifelse(Money_Switch == "99", 0.98, ifelse(Money_Switch == "90", 0.84, ifelse(Money_Switch == "80", 0.67, ifelse(Money_Switch == "70", 0.48, ifelse(Money_Switch == "60", 0.26, ifelse(Money_Switch == "50", 0, ifelse(Money_Switch == "40", -0.33, ifelse(Money_Switch == "30", -0.74, ifelse(Money_Switch == "20", -1.33, ifelse(Money_Switch == "10", -2, no = -2.5) )) ) )))))))
```

### II) For the population lottery
```{r}
Survey_Dummy_Variables_Rowan_V11 <- Survey_Dummy_Variables_Rowan_V10 %>% 
  mutate(., Pop_Switch = ifelse(Risk_lottery_populations_99 == "Option A", "99", ifelse(Risk_lottery_populations_90 == "Option A", "90", ifelse(Risk_lottery_populations_80 == "Option A", "80",ifelse(Risk_lottery_populations_70 == "Option A", "70", ifelse(Risk_lottery_populations_60 == "Option A", "60", ifelse(Risk_lottery_populations_50 == "Option A", "50", ifelse(Risk_lottery_populations_40 == "Option A", "40", ifelse(Risk_lottery_populations_30 == "Option A", "30", ifelse(Risk_lottery_populations_30 == "Option A", "30", ifelse(Risk_lottery_populations_20 == "Option A", "20", ifelse(Risk_lottery_populations_10 == "Option A", "10", "0"))) )))) ) )) )) %>% 
  
  # Get the CRRA into the code 
  mutate(., Pop_CRRA = ifelse(Pop_Switch == "99", 0.98, ifelse(Pop_Switch == "90", 0.84, ifelse(Pop_Switch == "80", 0.67, ifelse(Pop_Switch == "70", 0.48, ifelse(Pop_Switch == "60", 0.26, ifelse(Pop_Switch == "50", 0, ifelse(Pop_Switch == "40", -0.33, ifelse(Pop_Switch == "30", -0.74, ifelse(Pop_Switch == "20", -1.33, ifelse(Pop_Switch == "10", -2, no = -2.5) )) ) )))))))
```

## I) Sort the allocation budget variables

This is the new information given before Round 2: 

Initial round = All pops are of equal conservation status.
The 10 HR populations contains some unique genetic lineages.
Extinction of these = irremediable loss of genetic diversity of the oldest native fish species.

The interpretation is (From High Risk prospective): 
If from Round 1 to Round 2 allocation to HR goes UP : The respondent thought the HR were more valuable in the light of the new info (which highlights the uniqueness and the risk of huge loss). 
--> This is the most expected behavior.

If from Round 1 to Round 2 allocation to HR goes DOWN : Respondent thought the HR were not that valuable anymore. 
--> This is the less expected behavior. Maybe correlated to anticipation that LR can be unique too? 

If from Round 1 to Round 2 allocation to HR stays SAME : Respondent is unaffected by the info. 
--> Not expected. Either lack of understanding (test if correlated with duration) or maybe anticipation that LR can be unique too FROM THE START ! 
--> Unique case: If it stays the same at zero, could be that respondent attributes no value to the information compared to the fact that more populations can be saved by protecting the LR.

```{r}
Survey_Dummy_Variables_Rowan_V12 <- Survey_Dummy_Variables_Rowan_V11 %>% 
  
  # Create a nicer variable for Round 1:
  mutate(Alloc_LR_Round1 = ifelse(is.na(Risk_Reduction_LR_14_percent) & is.na(Risk_Reduction_LR_20_percent), NA, ifelse(is.na(Risk_Reduction_LR_20_percent), Risk_Reduction_LR_14_percent, ifelse(is.na(Risk_Reduction_LR_14_percent), Risk_Reduction_LR_20_percent, "Problem")))) %>% 
  mutate(Alloc_HR_Round1 = ifelse(is.na(Risk_Reduction_HR_50_percent) & is.na(Risk_Reduction_HR_70_percent), NA, ifelse(is.na(Risk_Reduction_HR_70_percent), Risk_Reduction_HR_50_percent, ifelse(is.na(Risk_Reduction_HR_50_percent), Risk_Reduction_HR_70_percent, "Problem")))) %>% 
  # Create a nicer variable for Round 2:
  mutate(Alloc_LR_Round2 = Risk_Reduction_LR_40_percent_Round_2) %>% 
  mutate(Alloc_HR_Round2 = Risk_Reduction_HR_80_percent_Round_2) %>% 
  # Create a nicer variable for Round 3:
  mutate(Alloc_LR_Round3 = Risk_Reduction_LR_40_percent_Round_3) %>% 
  mutate(Alloc_HR_Round3 = Risk_Reduction_HR_80_percent_Round_3) %>% 
  
  # Create a variable that summarises the allocation profile of a respondent: 
  # The idea is : Does the allocation goes up, or down? And then, up, down, the same?
  # To do that we need to put the focus on either the low risk or High risk.
  # I chose the High Risk allocation.
  mutate(., Alloc_profile_Round1to2 = ifelse(as.numeric(Alloc_HR_Round1) > as.numeric(Alloc_HR_Round2), "Down", ifelse(Alloc_HR_Round1 < Alloc_HR_Round2, "Up", ifelse(Alloc_HR_Round1 == Alloc_HR_Round2, "Same", "Problem")))) %>% 
  mutate(., Alloc_profile_Round2to3 = ifelse(Alloc_HR_Round2 > Alloc_HR_Round3, "Down", ifelse(Alloc_HR_Round2 < Alloc_HR_Round3, "Up", ifelse(Alloc_HR_Round2 == Alloc_HR_Round3, "Same", "Problem")))) %>% 

  unite("Alloc_profile_AllRounds", Alloc_profile_Round1to2, Alloc_profile_Round2to3, sep = "-", remove = F)  %>%   
  
  # Quantify this profile 
  mutate(., Alloc_diff_Round1to2 = as.numeric(Alloc_HR_Round2) - as.numeric(Alloc_HR_Round1)) %>% 
  mutate(., Alloc_diff_Round2to3 = as.numeric(Alloc_HR_Round3) - as.numeric(Alloc_HR_Round2))

```

```{r}
# Prepare some data for a plot : 
Allocation_diff_Round1to2 <- Survey_Dummy_Variables_Rowan_V12 %>% 
  select(Alloc_diff_Round1to2) %>% 
  rename(., Alloc_diff = "Alloc_diff_Round1to2") %>% 
  mutate(., Round = "One to two")
Allocation_diff_Round2to3 <- Survey_Dummy_Variables_Rowan_V12 %>% 
  select(Alloc_diff_Round2to3) %>% 
  rename(., Alloc_diff = "Alloc_diff_Round2to3") %>% 
  mutate(., Round = "Two to three")

Allocation_differences <- rbind(Allocation_diff_Round1to2, Allocation_diff_Round2to3)

# Now a nice density plot
ggplot(Allocation_differences, aes(x = Alloc_diff, fill = Round)) + geom_density(alpha = 0.5) +
 labs(x = "Difference of budget allocation to High-Risk populations between Rounds", y = "Density", title = "Niceplot") +
 theme_minimal()
```
```{r}
# Another plot to see the evolution in budget allocation 
Allocation_budgets1 <- Survey_Dummy_Variables_Rowan_V12 %>% 
  select(., Alloc_HR_Round1, Alloc_LR_Round1, name) %>% 
  mutate(., Round = 1) %>% 
  rename(., Budget_alloc_HR = "Alloc_HR_Round1") %>% 
  rename(., Budget_alloc_LR = "Alloc_LR_Round1") 
Allocation_budgets2 <- Survey_Dummy_Variables_Rowan_V12 %>% 
  select(., Alloc_HR_Round2, Alloc_LR_Round2, name)%>% 
  mutate(., Round = 2) %>% 
  rename(., Budget_alloc_HR = "Alloc_HR_Round2") %>% 
  rename(., Budget_alloc_LR = "Alloc_LR_Round2") 
Allocation_budgets3 <- Survey_Dummy_Variables_Rowan_V12 %>% 
  select(., Alloc_HR_Round3, Alloc_LR_Round3, name)%>% 
  mutate(., Round = 3) %>% 
  rename(., Budget_alloc_HR = "Alloc_HR_Round3") %>% 
  rename(., Budget_alloc_LR = "Alloc_LR_Round3") 


Allocation_budgets <- rbind(Allocation_budgets1, Allocation_budgets2, Allocation_budgets3)
Allocation_budgets$Budget_alloc_HR <- as.numeric(Allocation_budgets$Budget_alloc_HR)
Allocation_budgets$Budget_alloc_LR <- as.numeric(Allocation_budgets$Budget_alloc_LR)


```
# NEED HELP TO PLOT THAT

```{r}
mean(Survey_Dummy_Variables_Rowan_V12$Alloc_diff_Round1to2, na.rm = T)
mean(Survey_Dummy_Variables_Rowan_V12$Alloc_diff_Round2to3, na.rm = T)
mean(as.numeric(Allocation_budgets1$Budget_alloc_HR), na.rm = T)
mean(as.numeric(Allocation_budgets1$Budget_alloc_LR), na.rm = T)
mean(Allocation_budgets2$Budget_alloc_HR, na.rm = T)
mean(Allocation_budgets2$Budget_alloc_LR, na.rm = T)
mean(Allocation_budgets3$Budget_alloc_HR, na.rm = T)
mean(Allocation_budgets3$Budget_alloc_LR, na.rm = T)
```


## J) Simple version 

Make a Simple version of the table
```{r}
Survey_Dummy_Variables_Rowan_Simple_V1 <- Survey_Dummy_Variables_Rowan_V12 %>% 
  select(., - c(Year_of_birth, Age, Employment_status, Highest_education_level, Conservation_experience, Useless, True_false_question, Publications_read, Risk_lottery_money_99, Risk_lottery_money_90, Risk_lottery_money_80, Risk_lottery_money_70, Risk_lottery_money_60, Risk_lottery_money_50, Risk_lottery_money_40, Risk_lottery_money_30, Risk_lottery_money_20, Risk_lottery_money_10, Risk_lottery_populations_99, Risk_lottery_populations_90, Risk_lottery_populations_80, Risk_lottery_populations_70, Risk_lottery_populations_60, Risk_lottery_populations_50, Risk_lottery_populations_40, Risk_lottery_populations_30, Risk_lottery_populations_20, Risk_lottery_populations_10, Q1_Risk_Rating, Q2_Risk_Rating, Q3_Risk_Rating, Q4_Risk_Rating, Q5_Risk_Rating, Q6_Risk_Rating, Q7_Risk_Rating, Q8_Risk_Rating, Q9_Risk_Rating, Q10_Risk_Rating, Q1_Conservation_Risk_Rating_, Q2_Conservation_Risk_Rating_, Q3_Conservation_Risk_Rating_, Q4_Conservation_Risk_Rating_, Q5_Conservation_Risk_Rating_, Q6_Conservation_Risk_Rating_, Q7_Conservation_Risk_Rating_, Q8_Conservation_Risk_Rating_, Q9_Conservation_Risk_Rating_, Q10_Conservation_Risk_Rating_, Risk_Reduction_LR_14_percent, Risk_Reduction_LR_20_percent, Risk_Reduction_HR_70_percent, Risk_Reduction_HR_50_percent, Risk_Reduction_LR_40_percent_Round_2, Risk_Reduction_HR_80_percent_Round_2, Risk_Reduction_LR_40_percent_Round_3, Risk_Reduction_HR_80_percent_Round_3))

Survey_Dummy_Variables_Rowan_Simple_V1$Work_Exp_Dummy <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Work_Exp_Dummy)
Survey_Dummy_Variables_Rowan_Simple_V1$Study_Exp_Dummy <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Study_Exp_Dummy)
Survey_Dummy_Variables_Rowan_Simple_V1$Volunteering_Exp_Dummy <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Volunteering_Exp_Dummy)
Survey_Dummy_Variables_Rowan_Simple_V1$Confidence_in_survey <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Confidence_in_survey)
Survey_Dummy_Variables_Rowan_Simple_V1$Char_conservation_interest <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Char_conservation_interest)
Survey_Dummy_Variables_Rowan_Simple_V1$Scale_Sufficently_Protected_First <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Scale_Sufficently_Protected_First)
Survey_Dummy_Variables_Rowan_Simple_V1$Scale_Sufficently_Protected_Second <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Scale_Sufficently_Protected_Second)
Survey_Dummy_Variables_Rowan_Simple_V1$Alloc_HR_Round1 <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Alloc_HR_Round1)
Survey_Dummy_Variables_Rowan_Simple_V1$Money_Switch <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Money_Switch)
Survey_Dummy_Variables_Rowan_Simple_V1$Pop_Switch <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Pop_Switch)
Survey_Dummy_Variables_Rowan_Simple_V1$Pop_CRRA <- as.numeric(Survey_Dummy_Variables_Rowan_Simple_V1$Pop_CRRA)
```

```{r}
# summary(Survey_Dummy_Variables_Rowan_Simple_V1)
```

## K)
```{r}

```

# 2) Some plotting: 

```{r}
# esquisser(Survey_Dummy_Variables_Rowan_Simple_V1)
```


# 3) Now the model

In the regression we include : 

Gender, Birth, Country, Employment (Use employment VS study, use the dummy variables), Current position (University_DV + EPA_DV + Wildlife_DV), Highest education (Use only the dummies "Undergradute" and "Postgraduate"), Conservation experience (Use all the three as dummy variables), Confidence in Survey (once "I don't know" values are sorted), Char conservation interest, True or false score, Publications read (Use the three dummies), . 

```{r}

```

## Model Round 1) 

These budget allocation models will use the allocation amount to HR populations as a response variable, 
and all the remaining variables as explanatory.

We will try this Round per Round first and see what we get.

+ = I took this one into the model

 [1] "Age_grouped"                            +                                                     
 [2] "Country"                                                                          
 [3] "Geographic_group"                       +                                                    
 [4] "name"                                                                             
 [5] "Progress"                                                                         
 [6] "Duration"                               +                                                    
 [7] "Finished"                                                                         
 [8] "Gender"                                 +                                                    
 [9] "Male"                                                                                       
[10] "Female"                                                                           
[11] "Employed_Dummy"                         +                                                    
[12] "Student_Dummy"                          +                                                    
[13] "Retired_Dummy"                          +                                                    
[14] "University_Research_Dummy"              +                                          
[15] "Environmental_Protection_Agency_Dummy"  +                                          
[16] "Wildlife_Conservation_Dummy"            +                                          
[17] "Current_position_other"                                                           
[18] "Undergrad_Dummy"                        +                                          
[19] "Postgrad_Dummy"                         +                                          
[20] "Highest_education_level_other"                                                    
[21] "Work_Exp_Dummy"                         +                                          
[22] "Study_Exp_Dummy"                        +                                          
[23] "Volunteering_Exp_Dummy"                 +                                          
[24] "Confidence_in_survey"                   +                                          
[25] "Char_conservation_interest"             +                                          
[26] "Arctic_char_qualities"                                                            
[27] "No_Papers_Dummy"                        +                                          
[28] "Some_Papers_Dummy"                      +                                          
[29] "Many_Papers_Dummy"                      +                                          
[30] "Scale_Sufficently_Protected_First"      +                                          
[31] "Average_Lotto_Risk_Rating"                                                        
[32] "Average_Cons_Risk_Rating_"                                                        
[33] "Information_anticipation"                                                         
[34] "Did_you_feel_comfortable_with_
the_budget_allocation_experiment?_-_Selected_Choice"
[35] "Comfortable_with_experiment"                                                      
[36] "Scale_Sufficently_Protected_Second"     +                                          
[37] "Taxonomy"                                                                         
[38] "Survey_comments"                                                                  
[39] "Group"                                  +                                          
[40] "TrueFalseScore"                         +                                          
[41] "Money_Switch"                           +                                          
[42] "Money_CRRA"                             +                                          
[43] "Pop_Switch"                             +                                          
[44] "Pop_CRRA"                               +                                          
[45] "Alloc_LR_Round1"                                                                  
[46] "Alloc_HR_Round1"                                                                  
[47] "Alloc_LR_Round2"                                                                  
[48] "Alloc_HR_Round2"                        +                                          
[49] "Alloc_LR_Round3"                                                                  
[50] "Alloc_HR_Round3"                        +                                          
[51] "Alloc_profile_AllRounds"                +                                          
[52] "Alloc_profile_Round1to2"                                                          
[53] "Alloc_profile_Round2to3"                                                          
[54] "Alloc_diff_Round1to2"                                                             
[55] "Alloc_diff_Round2to3"   

```{r}
Linearmod_test_Round1 <- lm(formula = Alloc_HR_Round1 ~ 
                          Age_grouped + 
                          Geographic_group + 
                          Duration + 
                          Gender + 
                          Employed_Dummy + 
                          Student_Dummy + 
                          Retired_Dummy + 
                          University_Research_Dummy +
                          Environmental_Protection_Agency_Dummy +
                          Wildlife_Conservation_Dummy +
                          Undergrad_Dummy + 
                          Postgrad_Dummy +
                          Work_Exp_Dummy +
                          Study_Exp_Dummy +
                          Volunteering_Exp_Dummy +
                          Confidence_in_survey +
                          Char_conservation_interest +
                          # No_Papers_Dummy +  Removed as in total collinearity with Many papers dummy
                          Some_Papers_Dummy +
                          Many_Papers_Dummy +
                          Scale_Sufficently_Protected_First +
                          Scale_Sufficently_Protected_Second +
                          Group +
                          TrueFalseScore +
                          Money_Switch +
                          Money_CRRA +
                          Pop_Switch +
                          Pop_CRRA + 
                          Alloc_HR_Round2 +
                          Alloc_HR_Round3 +
                          Alloc_profile_AllRounds 
                        
                        , data = Survey_Dummy_Variables_Rowan_Simple_V1) 
```
  
```{r}
summary(Linearmod_test_Round1)
```
   
## Model Round 2)

```{r}
Linearmod_test_Round2 <- lm(formula = Alloc_HR_Round2 ~ 
                          Age_grouped + 
                          Geographic_group + 
                          Duration + 
                          Gender + 
                          Employed_Dummy + 
                          Student_Dummy + 
                          Retired_Dummy + 
                          University_Research_Dummy +
                          Environmental_Protection_Agency_Dummy +
                          Wildlife_Conservation_Dummy +
                          Undergrad_Dummy + 
                          Postgrad_Dummy +
                          Work_Exp_Dummy +
                          Study_Exp_Dummy +
                          Volunteering_Exp_Dummy +
                          Confidence_in_survey +
                          Char_conservation_interest +
                          # No_Papers_Dummy +  Removed as in total collinearity with Many papers dummy
                          Some_Papers_Dummy +
                          Many_Papers_Dummy +
                          Scale_Sufficently_Protected_First +
                          Scale_Sufficently_Protected_Second +
                          Group +
                          TrueFalseScore +
                          Money_Switch +
                          Money_CRRA +
                          Pop_Switch +
                          Pop_CRRA + 
                          Alloc_HR_Round1 +
                          Alloc_HR_Round3 +
                          Alloc_profile_AllRounds 
                        
                        , data = Survey_Dummy_Variables_Rowan_Simple_V1) 
```
  
```{r}
summary(Linearmod_test_Round2)
```

## Model Round 3) 

```{r}
Linearmod_test_Round3 <- lm(formula = Alloc_HR_Round3 ~ 
                          Age_grouped + 
                          Geographic_group + 
                          Duration + 
                          Gender + 
                          Employed_Dummy + 
                          Student_Dummy + 
                          Retired_Dummy + 
                          University_Research_Dummy +
                          Environmental_Protection_Agency_Dummy +
                          Wildlife_Conservation_Dummy +
                          Undergrad_Dummy + 
                          Postgrad_Dummy +
                          Work_Exp_Dummy +
                          Study_Exp_Dummy +
                          Volunteering_Exp_Dummy +
                          Confidence_in_survey +
                          Char_conservation_interest +
                          # No_Papers_Dummy +  Removed as in total collinearity with Many papers dummy
                          Some_Papers_Dummy +
                          Many_Papers_Dummy +
                          Scale_Sufficently_Protected_First +
                          Scale_Sufficently_Protected_Second +
                          Group +
                          TrueFalseScore +
                          Money_Switch +
                          Money_CRRA +
                          Pop_Switch +
                          Pop_CRRA + 
                          Alloc_HR_Round1 +
                          Alloc_HR_Round2 +
                          Alloc_profile_AllRounds 
                        
                        , data = Survey_Dummy_Variables_Rowan_Simple_V1) 
```
  
```{r}
summary(Linearmod_test_Round3)
```

## Model profile

Based on profile like Up-Down, Down-Down etc 


# 4) Various plots and statistics

Let's start with simple stats about individual variables.
Then we will look at how they interact with each other.

Lists of stats I'd want to know / plot: 
- Average, min, max duration. Plot frequency 
- Sex ratio 
- Employed vs Student vs Retired. Numbers simply.
- University research % 
- EPA %
- IFI or other %
- Undergrad, postgrad 
- Conservation: Study / Work / Volunteering exp in %. 
  How many cumulated the three?
  How many cumulated work + study?
- Confidence in survey: I want a frequency/barplot.
- Char interest : I want a frequency/barplot.
- Papers : Who, how many ! 
- Sufficiently protected first and second: Compare means and variances.
- Anticipation of info: Just %. 
- Comfortable with experiment : Just % 
- Taxonomy : Just %. 
- TrueFalse Score : Average, min max. 



Things I'd like to test : 
- Do a model for duration to see if some were faster/slower. 
- Do a model for confidence in survey to understand who didn't trust it. 
- Do a model for char interest to see who love the char!
- Do a model for Anticipation of info to see what profiles anticipated. 
- Do a model for trueFalse Score to see who they are. 

Also: 
- Show Pop and Money switches and CRRA into a table like in papers. 
- Find a way to plot the allocations in a nice way ! :) 

## 












This works